<div class="p-4">
  <div class="content bg-gray-300 h-auto pb-4 ">
    <div class="header-crud w-auto h-[50px] bg-gray-300  flex items-center justify-between p-2">
      <div class="header-title flex items-center">
          <h4 class="mx-4 font-bolds">Danh Sách Phiếu khám</h4>
      </div>
      <div class="flex items-center justify-between">
        <button class="p-4 mt-2" (click)="showCreatMedicalReport()">
          <ion-icon name="add-circle-outline" size="large"></ion-icon>
        </button>
        <input type="text" class="border rounded-2xl p-2 w-full max-w-sm h-[30px]" placeholder="Search...">
      </div>
    </div>
    <div class="mx-2">
      <table class = "w-full mt-2 rounded-t-lg mb-4">
        <thead class = "bg-gray-50 border-b-2 border-gray-200">
          <tr >
            <th></th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Mã Số</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Tên thú cưng</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Giới tính</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Ngày tạo</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Người Lập</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Ngày lập</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Xem</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Đơn thuốc</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">Lập hóa đơn</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">sửa</th>
            <th class = "p-3 text-sm font-semibold tracking-wide">xóa</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 overflow-y-auto">
          <ng-container *ngFor="let item of listMedicalReport; let i = index">
            <tr class="bg-gray-50 hover:bg-gray-200">
              <td class="p-3 text-center">
                <button (click)="toggleDetail(i)">
                  {{ isDetailVisible[i] ? '-' : '+' }}
                </button>
              </td>
              <td class="p-3 font-bold text-black-500 text-center whitespace-nowrap">{{item.code}}</td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">{{item.namePet}}</td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">{{item.genderPet}}</td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">{{item.createdDate}}</td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">Hoang Hung</td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">{{item.createdDate}}</td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                <button (click)="onShowMedicalReport(item)">
                  <ion-icon name="eye-outline" class = "w-[30px] h-[20px] hover:bg-slate-400 p-2 rounded-full text-blue-400"></ion-icon>
                </button>
              </td>
              <td class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                <button (click)="showPrescriptionDetails(item)">
                  <ion-icon name="bandage-outline" class = "w-[30px] h-[20px] hover:bg-slate-400 p-2 rounded-full text-blue-400"></ion-icon>
                </button>
              </td>
              <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center">
                  <button (click)="showCreateInvoice(item.id)">
                    <ion-icon name="clipboard-outline" class=" w-[30px] h-[20px] hover:bg-slate-400 p-2 rounded-full text-blue-400"></ion-icon>
                  </button>
              </td>
              <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center">
                <button (click)="onEditMedicalReport(item)">
                  <ion-icon id="setting" class="w-[30px] h-[20px] hover:bg-slate-400 p-2 rounded-full" name="settings-outline"></ion-icon>
                </button>
              </td>
              <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center items-center">
                <button >
                  <ion-icon id="trash" class="w-[30px] h-[20px] text-red-500 hover:bg-slate-400 p-2 rounded-full" name="trash-outline"></ion-icon>
                </button>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>


<div class = "modal fixed top-0 z-50 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" *ngIf="showMedicalReportTrue">
  <div class = "bg-white p-4 rounded-lg h-[80%] w-[60%] overflow-y-auto">
      <div class = "border-4 h-auto w-[80]">
        <div class= "header mt-2 mb-2">
          <span class = "text-center font-bold text-lg"><h4>TẠO PHIẾU KHÁM THÚ CƯNG</h4></span>
        </div>
        <form #medicalForm="ngForm" (ngSubmit)="submitMedicalForm(medicalForm)" >
          <div class="body flex space-x-[2%] pl-4 pr-4" id="r1">
            <div class="flex flex-col w-[23%] mb-4">
              <label for="NamePet" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" >Tên thú cưng</label>
              <input
                type="text"
                class="border rounded w-full h-[35px] pl-2"
                id="NamePet"
                name="NamePet"
                [(ngModel)]="medicalReport.namePet"
                required
                placeholder="Nhập tên thú cưng">
            </div>
            <div class="flex flex-col w-[23%] mb-4">
              <label for="NamePet" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tuổi thú cưng</label>
              <input
                type="number"
                class="border rounded w-full h-[35px] pl-2"
                id="NamePet"
                name="oldPet"
                [(ngModel)]="medicalReport.oldPet"
                required
                placeholder="Tuổi thú cưng">
            </div>
            <div class="flex flex-col w-[23%] mb-4">
              <label for="NamePet" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cân nặng</label>
              <input
                type="text"
                class="border rounded w-full h-[35px] pl-2"
                id="NamePet"
                name="weightPet"
                [(ngModel)]="medicalReport.weightPet"
                required
                placeholder="Cân nặng">
            </div>
            <div class="flex flex-col w-[23%]">
              <label for="NamePet" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Giống</label>
              <select name="genderPet" id="" class="border rounded  w-full h-[35px] pl-2" [(ngModel)]="medicalReport.genderPet" required>
                <option value="DUC">
                  Đực
                </option>
                <option value="CAI">
                  Cái
                </option>
              </select>
            </div>
          </div>
          <div class="body flex space-x-[2%] pl-4 pr-4" id="r2">
            <div class="flex flex-col w-[40%] h-auto mb-4">
              <label for="large-input" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Triệu chứng</label>
              <textarea name="symptom" id=""
              [(ngModel)]="medicalReport.symptom"
              rows="4"
              class="block w-full p-4 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"></textarea>
            </div>
            <div class="flex flex-col w-[60%]">
              <div class="flex space-x-4">
                <div class = "flex flex-col w-[50%] h-auto mb-4">
                  <label for="" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Số điện thoại</label>
                  <input type="text"
                  name="numberPhone"
                  placeholder="Nhập số điện thoại của chủ"
                  class="block p-1 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                  [(ngModel)]="medicalReport.numberPhone">
                </div>
                <div class ="flex flex-col w-[50%] h-auto mb-4">
                  <label for="" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Địa chỉ</label>
                  <input
                  name="address"
                  placeholder="Nhập địa chỉ"
                  type="text"
                  [(ngModel)]="medicalReport.address"
                  class ="block w-full p-1 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
              </div>
              <div class="flex items-center space-x-4">
                <div class ="flex flex-col w-[50%] h-auto mb-4">
                  <label for="" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tên chủ</label>
                  <input
                  name="petOwner"
                  placeholder="Nhập tên chủ thú cưng"
                  [(ngModel)]="medicalReport.petOwner"
                  type="text" class ="block w-full p-1 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div class ="flex flex-col w-[50%] h-auto mb-4">
                  <label for="" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Lịch Khám lại</label>
                  <input
                  name = "followSchedule"
                  type="datetime-local"
                  [(ngModel)]="medicalReport.followSchedule"
                  class ="block w-full p-1 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
              </div>
            </div>

          </div>
          <div class="body flex space-x-[2%] pl-4 pr-4" id="r2">
            <div class="flex flex-col w-[100%] h-auto mb-4">
              <label for="" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white text-center">Chuẩn đoán</label>
              <textarea name="diagnosed" id=""
              [(ngModel)]="medicalReport.diagnosed"
              rows="10"
              placeholder="Nhập chuẩn đoán thú y"
              class="block w-full p-4 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"></textarea>
            </div>
          </div>
          <div class="flex justify-center mt-4 mb-4 space-x-2">
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded" [disabled]="medicalForm.invalid" (click)="createMedicalReport()">Lưu</button>
            <button type="submit" class = "bg-red-500 text-white px-4 py-2 rounded" (click)="showCreatMedicalReport()">Hủy</button>
          </div>
        </form>
      </div>
  </div>
</div>



<!-- show Success -->
<div *ngIf="showSuccess" class="modal fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded-lg w-[20%]  h-auto flex items-center justify-center flex-col">
    <div class = "bg-green-200 w-[40px] h-[40px] rounded-full mb-2 flex items-center justify-center">
      <ion-icon name="checkmark-outline" class = "text-green-600"></ion-icon>
    </div>
    <p class = "block mb-2 text-sm font-medium text-gray-900 dark:text-white text-center p-1">Phiếu khám được tạo thành công</p>
    <div class = "bg-blue-500 h-auto w-auto p-1 rounded-lg text-white hover:bg-slate-400 border-1" (click)="closeReport()">
        <button>tiếp tục</button>
    </div>
  </div>
</div>

<div class="modal fixed top-0 z-30 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" *ngIf="showMedicalReport">
  <div class="bg-white p-4 rounded-lg w-[60%] max-h-[80%] overflow-y-auto custom-scrollbar">
    <div class="flex justify-end pb-2 space-x-2">
      <div>
        <button class="text-center">
          <ion-icon name="print-outline" class="text-[20px] text-center"></ion-icon>
        </button>
      </div>
      <div>
        <button (click)="closeReport()">
          <ion-icon name="backspace-outline" class="text-[20px] text-center"></ion-icon>
        </button>
      </div>
    </div>
    <div  id="medical-report" class="border-2 p-2 border-black">
      <div class="header text-center">
        <span class="font-bold underline">
          THÔNG TIN PHIẾU KHÁM
        </span>
      </div>
      <div class="body p-4">
        <div class="flex justify-between">
          <div class="text-center">
            <span class="font-medium">
              PHÒNG KHÁM THÚ CƯNG<br>
              ĐÀ NẴNG
            </span>
          </div>
          <div class="text-center font-medium">
            CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM <br>
            <span class="underline">Độc lập - Tự do - Hạnh phúc</span>
          </div>
        </div>
        <div class="text-center p-6">
          <span class="font-bold">PHIẾU KHÁM SỨC KHỎE THÚ CƯNG</span>
        </div>
        <div>
          <div class="flex">
            <div class="w-[20%]">
              <img src="{{medicalReport.urlPet}}" alt="" class="w-[120px] h-[120px] object-cover">

            </div>
            <div class="w-[80%]">
              <div class="ml-2 flex">
                <div class="">
                  <span class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                    Tên thú cưng: {{medicalReport.namePet}}
                  </span>
                </div>
                <div>
                  <span class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                    Giới tính: {{medicalReport.genderPet}}
                  </span>
                </div>
              </div>
              <div class="flex ml-2 space-x-[20%]">
                <div>
                  <span class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                    Tuổi: {{medicalReport.oldPet}}
                  </span>
                </div>

              </div>
              <div class="ml-2">
                <span class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                  Địa chỉ: {{medicalReport.address}}
                </span>
              </div>
              <div class="ml-2">
                <span class="p-3 text-sm text-gray-700 text-center whitespace-nowrap">
                  Lịch khám lại: {{medicalReport.followSchedule}}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="text-center">
          <span class="font-bold">
            CHUẨN ĐOÁN BỆNH TÌNH
          </span>
        </div>
        <div class="mt-2">
          <span class="font-medium">
            I. Triệu chứng:
          </span>
        </div>
        <div class="ml-2">
          <p class="text-sm text-gray-700 whitespace-pre-line">
            {{medicalReport.symptom}}
          </p>
        </div>
        <div class="mt-2">
          <span class="font-medium">
            II. Chuẩn đoán của bác sĩ:
          </span>
        </div>
        <div class="ml-2">
          <p class="text-sm text-gray-700  whitespace-pre-line">
            {{medicalReport.diagnosed}}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fixed top-0 z-30 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" *ngIf="showPrescription">
  <div class="w-[90%] h-[90%] bg-white">
    <div class="header-title w-[100%] h-[6%] bg-red-50 flex items-center pl-2">
      <span>ĐƠN THUỐC</span>
    </div>
    <div class="w-[100%] h-[86%] bg-gray-200 flex items-center justify-center space-x-10 pt-4 pb-4">
      <div class="w-[30%] h-[100%]  space-y-2">
        <div class="w-[100%] h-[50%] bg-white shadow-sm">
          <div class="header-title w-[100%] h-[15%] bg-green-300 flex items-center pl-2">
            <span class="text-white text-[14px]">Loại thuốc</span>
          </div>
          <div class="body w-[100%] h-[85%] p-2">
            <div class="grid grid-cols-3 gap-2" >
              <button  (click) = "getMedicineWithTypeMedicine(item.id)" class="text-[14px] pt-1 pb-1 font-sans h-[100%] bg-gray-400 border border-gray-200 rounded-md"*ngFor="let item of typeMedicine">
                <span class="text-white">{{item.name}}</span>
              </button>
            </div>
          </div>
        </div>
        <div class="w-[100%] h-[50%] bg-white shadow-sm">
          <div class="header-title w-[100%] h-[15%] bg-green-300 flex items-center pl-2">
            <span class="text-white text-[14px]">Thuốc</span>
          </div>
          <div class="body w-[100%] h-[85%] p-2">
            <div class="grid grid-cols-3 gap-2">
              <button class="text-[14px] pt-1 pb-1 font-sans h-[100%] bg-gray-400 border border-gray-200 rounded-md" *ngFor="let item of medicineList" (click)="addToTreatment(item)">
                <span class="text-white">{{item.name}}</span>
              </button>

            </div>
          </div>
        </div>
      </div>
      <div class="w-[40%] h-[100%] bg-white overflow-auto">
        <div class="title w-[100%] h-[10%] flex flex-col items-center justify-center">
          <span class="text-green-500 ">ĐƠN THUỐC THÚ CƯNG</span>
          <span class="text-gray-400">Mã số:</span>
        </div>
        <div class="body-1 w-[100%] h-[100%] pt-4">
          <div class="w-[100%] h-[20%] grid grid-cols-2 gap-2 p-2">
            <div class="">
              <span class="text-start text-[14px] ">Tên thú cưng: <span class="text-gray-500">{{prescription.namePet}}</span></span>
            </div>
            <div class="">
              <span class="text-start text-[14px] ">Tuổi: <span class="text-gray-500">{{prescription.oldPet}}</span></span>
            </div>
            <div class="">
              <span class="text-start text-[14px] ">Giới tính: <span class="text-gray-500">{{prescription.genderPet}}</span></span>
            </div>
            <div class="">
              <span class="text-start text-[14px] ">Họ và tên chủ: <span class="text-gray-500">{{prescription.namePetOwen}}</span></span>
            </div>
            <div class="">
              <span class="text-start text-[14px] ">Địa chỉ: <span class="text-gray-500">{{prescription.address}}</span></span>
            </div>
          </div>
          <div class="w-full h-auto p-2 flex flex-col space-y-2">
            <span>
              Lí do khám: <span class="text-gray-500 break-words whitespace-normal">{{ prescription.symptom }}</span>
            </span>
            <span>
              Chuẩn đoán: <span class="text-gray-500 break-words whitespace-normal">{{ prescription.diagnosed}}</span>
            </span>
          </div>
          <div class="w-[100%] h-[6%] p-2">
            <span>Thuốc điều trị</span>
          </div>
          <div class="w-[100%] h-auto p-2 space-y-1">
            <div class="flex items-center justify-center border-t-2 border-b-2" *ngFor="let treatment of treatmentList; let i = index">
              <div class="w-[10%]">
                <span>{{ i + 1 }}.</span>
              </div>
              <div class="w-[80%]">
                <div class="space-x-2 flex items-center justify-between">
                  <span class="text-[14px] w-auto font-medium">{{treatment.name}}</span>
                  <div class="w-[30%]">
                    <span class="text-gray-500 text-[14px] w-[20%]">Số lượng</span>
                    <input
                    (change)="calculateTotalMedicine()"
                    [(ngModel)]="treatment.countMedicine"
                    min="1" type="number" class="w-[20%] outline-none pl-1 border-b-1 border-b-black text-gray-500 text-[14px] no-spinner">
                    <span class="text-gray-500 text-[14px] w-[20%]">{{treatment.unitMedicine}}</span>
                  </div>
                </div>
                <div class="flex items-center">
                  <span class="text-gray-500 text-[14px] w-[20%]">Cách dùng</span>
                  <input [(ngModel)]="treatment.instructionsForUse" type="text" class="p-1 outline-none text-gray-500 text-[14px]">
                </div>
              </div>
              <div class="w-[10%] flex items-center justify-center">
                <button (click)="removeFromTreatment(treatment)">
                  <svg class="w-6 h-6" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>cancel</title> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="work-case" fill="#000000" transform="translate(91.520000, 91.520000)"> <polygon id="Close" points="328.96 30.2933333 298.666667 1.42108547e-14 164.48 134.4 30.2933333 1.42108547e-14 1.42108547e-14 30.2933333 134.4 164.48 1.42108547e-14 298.666667 30.2933333 328.96 164.48 194.56 298.666667 328.96 328.96 298.666667 194.56 164.48"> </polygon> </g> </g> </g></svg>
                </button>
              </div>
            </div>
          </div>
          <div class="w-[100%] h-[20%] p-2 flex items-center justify-between">
            <span class="text-[14px]">Tổng tiền thuốc</span>
            <span class="text-[14px]">{{ totalMedicine | number:'1.0-0' }} Đồng</span>
          </div>
        </div>
      </div>
      <div class="w-[20%] h-[100%] bg-white">
        <div class="header-title w-[100%] h-[6%] p-2 bg-red-200 flex items-center justify-center">
          Ghi Chú
        </div>
        <div class="body w-[100%] h-[94%] p-2 flex justify-center">
          <textarea [(ngModel)]="prescription.note"  class="bg-gray-200 w-[90%] h-[100%] outline-none p-2 text-[14px] text-gray-500" name="" id=""></textarea>
        </div>
      </div>
    </div>
    <div class="w-[100%] h-[8%] flex items-center justify-between">
      <div class="w-[50%] h-[100%] flex items-center p-2">
        <button [disabled]="checkCreateOrUpdate"  class="bg-red-500 p-2 pl-8 pr-8 rounded-full text-white">Xóa</button>
      </div>
      <div class="w-[50%] h-[100%] flex justify-end items-center p-2 space-x-2">
        <button [disabled]="checkCreateOrUpdate"  class="bg-blue-400 p-2 pl-8 pr-8 rounded-full text-white">Cập nhập</button>
        <button [disabled]="checkCreateOrUpdate"  (click)="createPrescription()" class="bg-blue-400 p-2 pl-8 pr-8 rounded-full text-white">Lưu</button>
        <button (click)="tradeShowPrescription()" class="bg-white p-2 pl-8 pr-8 rounded-full text-gray-500 border-2">Hủy</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showSuccessPrescription" class="fixed top-14 right-4 bg-white text-white px-4 py-3 rounded-lg shadow-lg transition-opacity duration-500">
  <div class="flex items-center">
    <svg class="w-7 h-7 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#24f547"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M8.5 12.5L10.5 14.5L15.5 9.5" stroke="#24f547" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M7 3.33782C8.47087 2.48697 10.1786 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 10.1786 2.48697 8.47087 3.33782 7" stroke="#24f547" stroke-width="1.5" stroke-linecap="round"></path> </g></svg>
    <span class="mr-3 text-[14px] text-black">Đơn thuốc được tạo thành công!!!</span>
    <div
      class="h-1 bg-green-500 absolute bottom-0 left-0 transition-all"
      [style.width.%]="progressWidth">
    </div>
  </div>
</div>

<div class="modal fixed top-0 z-30 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" *ngIf="showInvoice">
  <div class="w-[80%] h-[90%] bg-white rounded-lg">
    <div class="header-title w-[100%] h-[6%] bg-blue-300 flex items-center pl-2 rounded-t-lg">
      <span class="text-white">HÓA ĐƠN</span>
    </div>
    <div class="body flex w-[100%] h-[86%] p-2 bg-slate-200 overflow-y-auto">
      <div class="w-[30%] h-[100%]">
        <div class="header w-[100%] h-[6%] flex items-center p-2">
          <span class="w-[30%] text-[14px]">dịch vụ: </span>
          <span class="w-[70%] text-[14px]">
            <select class="w-[100%] text-[14px] p-1 bg-slate-200 outline-none border-b-2 border-black" name="" id="">
              <option value="default">Vui lòng chọn dịch vụ</option>
            </select>
          </span>
        </div>
        <div class="body w-[100%] h-[94%] p-2">
          <div class="body w-[100%]">
            <table class="w-[100%]">
              <thead class="bg-[#f0fcfc]">
                <tr>
                  <th class="w-[80%] text-blue-300 p-2 text-[14px] text-center font-medium">Tên</th>
                  <th class="w-[20%] text-blue-300 p-2 text-[14px] text-center font-medium">Đơn giá</th>
                </tr>
              </thead>
              <tbody class="" *ngFor="let item of serviceMedicalList"  >
                <tr class="border-b-[1px] border-t-[1px] bg-white m-1 border-gray-200">
                  <td class="p-3 text-sm text-gray-700 text-start whitespace-nowrap border-r-[1px] border-gray-200"><button (click)="addServiceInput(item)">{{item.name}}</button></td>
                  <td class="p-3 text-sm text-gray-700 text-right whitespace-nowrap">{{item.feeService | number:'1.0-0' }} đồng </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="w-[70%] h-[100%]">
        <div class="header w-[100%] h-[15%] p-2">
          <div class="w-[100%] flex space-x-1 items-center">
            <span class="w-auto text-[14px]">Khách hàng: <span class="text-[14px] font-bold">{{userPetMedicalReport.userName}}</span></span>
            <button>
              <svg  viewBox="0 0 1024 1024" class="icon w-10 h-10" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M512.7 472.2l-43.3 75.1h86.7z" fill="#843A5F"></path><path d="M633.6 174.6H392.9l-73.8 347 194.1 215.7 193.1-214.5 1-1.2z" fill="#843A5F"></path><path d="M512.4 656.8m-214 0a214 214 0 1 0 428 0 214 214 0 1 0-428 0Z" fill="#AE9AA4"></path><path d="M512.4 873.8c-58 0-112.5-22.6-153.5-63.6s-63.6-95.5-63.6-153.5 22.6-112.5 63.6-153.5 95.5-63.6 153.5-63.6 112.5 22.6 153.5 63.6 63.6 95.5 63.6 153.5-22.6 112.5-63.6 153.5c-41.1 41-95.6 63.6-153.5 63.6z m0-428c-116.4 0-211 94.7-211 211s94.7 211 211 211c116.4 0 211-94.7 211-211s-94.7-211-211-211z" fill="#843A5F"></path><path d="M512.4 578l-70.5-121.9h140.9z" fill="#FFFFFF"></path><path d="M512.4 584l-75.6-131H588l-75.6 131z m-65.3-124.9l65.2 113 65.2-113H447.1zM675.2 185.4l-0.2-0.4c-5.8-18.4-14.7-35.6-26.3-51.1l-0.1-0.2c-5.5-7.3-11.7-14.3-18.4-20.7-19.6-18.8-43.7-32.8-69.7-40.4-15.6-4.6-31.8-6.9-48.2-6.9-14.3 0-28.6 1.8-42.3 5.3-1.8 0.5-3.2 0.8-4.5 1.2-26.8 7.6-51.6 21.9-71.7 41.4-26.8 25.9-44.1 59-49.9 95.6-1.4 8.8-2.1 17.9-2.1 27 0 15.1 2 30 5.9 44.4 2 7.6 4.6 15.1 7.7 22.2 26.8 63.1 88.4 103.8 157 103.8 63.5 0 121.3-34.9 150.9-91 4.3-8 7.9-16.6 10.8-25.3 5.8-17.4 8.8-35.6 8.8-54.1 0-17.3-2.6-34.4-7.7-50.8z" fill="#843A5F"></path><path d="M364.9 294.4a149.1 176.4 0 1 0 298.2 0 149.1 176.4 0 1 0-298.2 0Z" fill="#E6D8DF"></path><path d="M514 473.8c-83.9 0-152.1-80.5-152.1-179.4S430.2 115 514 115s152.1 80.5 152.1 179.4S597.9 473.8 514 473.8z m0-352.8c-80.6 0-146.1 77.8-146.1 173.4S433.5 467.8 514 467.8c80.6 0 146.1-77.8 146.1-173.4S594.6 121 514 121z" fill="#843A5F"></path><path d="M513.5 412.1c-23.1 0-46.5-5.6-46.5-16.3h6c0 3.5 14.3 10.3 40.5 10.3s40.5-6.8 40.5-10.3h6c0 10.7-23.4 16.3-46.5 16.3z" fill="#843A5F"></path><path d="M750 923.1H275.5c-6.6 0-12-5.4-12-12V535.5c0-6.6 5.4-12 12-12H750c6.6 0 12 5.4 12 12v375.6c0 6.6-5.4 12-12 12z" fill="#FFFFFF"></path><path d="M750 926.1H275.5c-8.3 0-15-6.7-15-15V535.5c0-8.3 6.7-15 15-15H750c8.3 0 15 6.7 15 15v375.6c0 8.3-6.7 15-15 15zM275.5 526.5c-5 0-9 4-9 9v375.6c0 5 4 9 9 9H750c5 0 9-4 9-9V535.5c0-5-4-9-9-9H275.5z" fill="#843A5F"></path><path d="M287.7 749.9c-12.9 18-33.9 18-46.8 0s-12.9-47.1 0-65c12.9-18 33.9-18 46.8 0 12.9 17.9 12.9 47 0 65z" fill="#E6D8DF"></path><path d="M264.3 766.4c-9.8 0-19-5.2-25.8-14.7-13.6-18.9-13.6-49.7 0-68.6 6.8-9.5 16-14.7 25.8-14.7s19 5.2 25.8 14.7c13.6 18.9 13.6 49.7 0 68.6-6.8 9.4-16 14.7-25.8 14.7z m0-92c-7.8 0-15.3 4.3-21 12.2-12.2 17-12.2 44.6 0 61.5 5.7 7.9 13.1 12.2 21 12.2s15.3-4.3 21-12.2c12.2-17 12.2-44.6 0-61.5-5.8-7.9-13.2-12.2-21-12.2z" fill="#843A5F"></path><path d="M785.8 749.9c-12.9 18-33.9 18-46.8 0s-12.9-47.1 0-65c12.9-18 33.9-18 46.8 0 12.9 17.9 12.9 47 0 65z" fill="#E6D8DF"></path><path d="M762.4 766.4c-9.8 0-19-5.2-25.8-14.7-13.6-18.9-13.6-49.7 0-68.6 6.8-9.5 16-14.7 25.8-14.7s19 5.2 25.8 14.7c13.6 18.9 13.6 49.7 0 68.6-6.8 9.4-16 14.7-25.8 14.7z m0-92c-7.8 0-15.3 4.3-21 12.2-12.2 17-12.2 44.6 0 61.5 5.7 7.9 13.1 12.2 21 12.2s15.3-4.3 21-12.2c12.2-17 12.2-44.6 0-61.5-5.7-7.9-13.1-12.2-21-12.2z" fill="#843A5F"></path><path d="M635.3 137.5L583 108.3l-2.7 2c-5-3.1-17.7-4.9-49.6-2.6-23.6 1.7-47.2 4.9-47.4 5l-0.4 0.1-94.4 42.2-32 20.3 4.8 126.4c-0.6 3.9-0.6 6.1-0.6 6.4v0.5l7.8 23.4-1.1-29.9c1.4-9.3 5.9-28.5 19.6-51.1 17.9-29.4 55.8-70.8 134.5-100.6 3-1.1 5.8-2.2 8.5-3.3l-1.6 1.2h9.2c43.5 0 74.8 45.5 93.5 83.7 20.5 42 30.5 84.5 30.6 85l5.7 24.7 1.2-154.2-33.3-50z" fill="#843A5F"></path><path d="M572 320.7a29.7 16.3 0 1 0 59.4 0 29.7 16.3 0 1 0-59.4 0Z" fill="#FF9FB9"></path><path d="M578 257.3c-11.5 0-20.9 12.7-20.9 28.4S566.5 314 578 314s20.9-12.7 20.9-28.4-9.4-28.3-20.9-28.3z" fill="#843A5F"></path><path d="M569 291.8a9 9.9 0 1 0 18 0 9 9.9 0 1 0-18 0Z" fill="#FFFFFF"></path><path d="M547 253.7c8.3-8.1 19-13.6 30.2-16.4 14.2-3.6 24.8 3.1 34.8 12.6 1.4 1.3 3.5-0.8 2.1-2.1-9.5-9.1-20.5-16.6-34.3-14.2-12.9 2.3-25.6 8.8-35 17.9-1.3 1.4 0.8 3.5 2.2 2.2z" fill="#843A5F"></path><path d="M396.7 320.7a29.7 16.3 0 1 0 59.4 0 29.7 16.3 0 1 0-59.4 0Z" fill="#FF9FB9"></path><path d="M450.1 257.3c-11.5 0-20.9 12.7-20.9 28.4s9.4 28.4 20.9 28.4 20.9-12.7 20.9-28.4-9.4-28.4-20.9-28.4z" fill="#843A5F"></path><path d="M441.1 291.8a9 9.9 0 1 0 18 0 9 9.9 0 1 0-18 0Z" fill="#FFFFFF"></path><path d="M483.2 251.5c-9.3-9.1-22.1-15.6-35-17.9-13.8-2.4-24.7 5-34.3 14.2-1.4 1.3 0.7 3.5 2.1 2.1 9.9-9.5 20.6-16.2 34.8-12.6 11.2 2.8 21.9 8.3 30.2 16.4 1.5 1.3 3.6-0.8 2.2-2.2z" fill="#843A5F"></path><path d="M512 684.2m-126.4 0a126.4 126.4 0 1 0 252.8 0 126.4 126.4 0 1 0-252.8 0Z" fill="#FFFFFF"></path><path d="M512 814.1c-71.7 0-129.9-58.3-129.9-129.9 0-71.7 58.3-129.9 129.9-129.9 71.7 0 129.9 58.3 129.9 129.9 0.1 71.7-58.2 129.9-129.9 129.9z m0-252.7c-67.7 0-122.8 55.1-122.8 122.8 0 67.7 55.1 122.8 122.8 122.8 67.7 0 122.8-55.1 122.8-122.8 0.1-67.7-55-122.8-122.8-122.8z" fill="#843A5F"></path><path d="M638.4 684.2c0 69.8-56.6 126.4-126.4 126.4S385.7 754 385.7 684.2" fill="#E6D8DF"></path><path d="M512 814.1c-71.7 0-129.9-58.3-129.9-129.9h7.1c0 67.7 55.1 122.8 122.8 122.8 67.7 0 122.8-55.1 122.8-122.8h7.1c0.1 71.7-58.2 129.9-129.9 129.9z" fill="#843A5F"></path><path d="M566.2 760H559c0-25.9-21.1-47-47-47s-47 21.1-47 47h-7.1c0-29.8 24.3-54.1 54.1-54.1s54.2 24.3 54.2 54.1z" fill="#843A5F"></path><path d="M436.2 662.5v-7.1c25.9 0 47-21.1 47-47h7.1c0 29.8-24.3 54.1-54.1 54.1zM587.9 662.5c-29.8 0-54.1-24.3-54.1-54.1h7.1c0 25.9 21.1 47 47 47v7.1z" fill="#843A5F"></path><path d="M433.3 894.4l-32.3-56h64.6zM512.7 894.4l-32.3-56H545zM590.8 894.4l-32.4-56h64.7z" fill="#843A5F"></path></g></svg>
            </button>
          </div>
          <div class="w-[100%]">
            <span class="w-[50%] text-[14px]">Thú cưng: {{userPetMedicalReport.profilePet}}</span>
          </div>
        </div>
        <div class="body w-[100%] h-auto p-2">
          <div class="body w-[100%] h-[80%]">
            <table class="w-[100%]">
              <thead class="bg-[#f0fcfc]">
                <tr>
                  <th class="w-[5%] text-blue-300 p-2 text-[14px] text-center font-medium">#</th>
                  <th class="w-[75%] text-blue-300 p-2 text-[14px] text-center font-medium">Tên dịch vụ</th>
                  <th class="w-[20%] text-blue-300 p-2 text-[14px] text-center font-medium">Giá</th>
                </tr>
              </thead>
              <tbody class="" *ngFor="let item of listServiceMedicalInput; let i = index">
                <tr class="border-b-[1px] border-t-[1px] bg-white m-1 border-gray-200">
                  <td class="p-3 text-sm text-gray-700 text-start whitespace-nowrap border-r-[1px] border-gray-200">{{i + 1}}</td>
                  <td class="p-3 text-sm text-gray-700 text-start whitespace-nowrap border-r-[1px] border-gray-200">{{item.name}}</td>
                  <td class="p-3 text-sm text-gray-700 text-start whitespace-nowrap">{{item.feeService | number:'1.0-0'}} Đồng</td>
                </tr>
              </tbody>
            </table>
            <div class="w-[100%]">
              <div class="bg-[#f0fcfc] w-[100%] h-[10%] p-2 flex items-center">
                <div class="w-[80%] items-end">
                  <span class="p-3 text-sm text-gray-700 text-end whitespace-nowrap">Tổng cộng</span>
                </div>
                <div class="w-[20%] items-end">
                  <span class="p-3 text-sm text-gray-700 text-start whitespace-nowrap">{{totalInvoice | number:'1.0-0'}}Đồng</span>
                </div>
              </div>
            </div>
            <div class="w-[100%] h-[20%] p-2 bg-white flex flex-col items-end">
              <div class="w-[40%] text-left">
                <span class="p-3 text-sm text-gray-700 text-start whitespace-nowrap">
                  Tổng giảm:
                  <input (keyup.enter)="calculateTotalInvoice()" [(ngModel)]="reducedAmount" class="p-1 text-sm text-gray-700 text-start whitespace-nowrap outline-none no-spinner border-[1px] border-gray-500 rounded-lg"  type="number">
                </span>
              </div>
              <div class="w-[40%] text-left">
                <span class="p-3 text-sm text-gray-700 text-start whitespace-nowrap">
                  Tổng tiền cần trả: {{totalInvoice | number:'1.0-0'}} Đồng
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="w-[100%] h-[30%] p-2 flex space-x-2">
          <div class="w-[50%] rounded-lg border-cyan-300 border-[1px] p-2">
            <div class=" header w-[100%] h-[10%]">
              <span class="text-[14px] pl-2">Ghi chú</span>
            </div>
            <div class="body w-[100%] pt-2">
              <textarea [(ngModel)]="noteInvoice" class="w-[100%] outline-none rounded-lg p-2 text-sm text-gray-700 text-start whitespace-nowrap h-32" name="" id=""></textarea>
            </div>
          </div>
          <div class="w-[50%] rounded-lg border-cyan-300 border-[1px] p-2">
            <div class=" header w-[100%] h-[10%]">
              <span class="text-[14px] pl-2">Thanh toán</span>
            </div>
            <div class="body w-[100%] pt-2">
              <div class=" w-[100%] bg-gray-300 pt-2 pb-2 rounded-lg">
                <div class="w-[100%]">
                  <span class="p-2 text-sm text-gray-700 text-start whitespace-nowrap">Thanh toán khi lập hóa đơn</span>
                </div>
                <div class="w-[100%] flex flex-col items-end ">
                  <div class="w-[70%] text-left flex space-x-1 items-center pr-2">
                    <span class="w-[40%] p-2 text-sm text-gray-700 text-start whitespace-nowrap">Số tiền nhận : </span>
                    <input [(ngModel)]="amountReceived" (keyup.enter)="calculaAmountReceived()" class=" w-[60%] p-1  text-sm text-gray-700 text-right whitespace-nowrap outline-none no-spinner border-[1px] border-gray-500 rounded-lg"  type="number">
                  </div>
                  <div class="w-[70%] text-left">
                    <span class="w-[30%] p-2 text-sm text-gray-700 text-start whitespace-nowrap">Số tiền trả lại : {{amountToPay | number:'1.0-0'}} Đồng</span>
                  </div>
                  <div class="w-[70%] text-left">
                    <span class="w-[30%] p-2 text-sm text-gray-700 text-start whitespace-nowrap">Tài khoản nhận :</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="w-[100%] h-[8%] flex items-center justify-end">
      <div class="w-[50%] h-[100%] flex justify-end items-center p-2 space-x-2">
        <button class="bg-blue-400 p-2 pl-8 pr-8 rounded-full text-white">Cập nhập</button>
        <button (click)="createInvoice()" class="bg-blue-400 p-2 pl-8 pr-8 rounded-full text-white">Lưu</button>
        <button (click)="tradeInvoice()" class="bg-white p-2 pl-8 pr-8 rounded-full text-gray-500 border-2">Hủy</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showSuccessInvoice" class="fixed top-14 right-4 bg-white text-white px-4 py-3 rounded-lg shadow-lg transition-opacity duration-500">
  <div class="flex items-center">
    <svg class="w-7 h-7 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#24f547"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M8.5 12.5L10.5 14.5L15.5 9.5" stroke="#24f547" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M7 3.33782C8.47087 2.48697 10.1786 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 10.1786 2.48697 8.47087 3.33782 7" stroke="#24f547" stroke-width="1.5" stroke-linecap="round"></path> </g></svg>
    <span class="mr-3 text-[14px] text-black">Phiếu khám được tạo thành  công!!!</span>
    <div
      class="h-1 bg-green-500 absolute bottom-0 left-0 transition-all"
      [style.width.%]="progressWidth">
    </div>
  </div>
</div>
